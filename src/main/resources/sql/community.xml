<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="communityns">

	<!-- 글작성 -->
	<insert id="insertBoard" parameterType="community">
		 insert into community
		values(community_seq.nextval,#{com_title},#{com_writer},
		0,sysdate,#{com_content},#{com_file},0)
	</insert>
	
	<!-- 글갯수 -->
	<select id="getTotal" parameterType="community" resultType="int">
		select count(*) from community 
		<where>
			<if test="keyword != null and search !='subcon'">
				${search} like '%'||#{keyword}||'%'
			</if>
			<if test="keyword != null and search=='subcon'">
				com_title like '%'||#{keyword}||'%' or
				com_content like '%'||#{keyword}||'%'
			</if>			
		</where>
	</select>
	
	<!-- 글목록 -->
	<select id="list" parameterType="community" resultType="community">
		select * from (select a.*,rowNum rn from (
			select * from community
		<where>
			<if test="keyword != null and search!='subcon'">
				${search} like '%'||#{keyword}||'%'
			</if>
			<if test="keyword != null and search=='subcon'">
				com_title like '%'||#{keyword}||'%' or
				com_content like '%'||#{keyword}||'%'
			</if>
		</where>			
			 order by com_no desc) a )
			where rn between #{startRow} and #{endRow}
	</select>
	
	<!-- 조회수 증가 -->
	<update id="read" parameterType="int">
	   update community set com_readcnt=com_readcnt+1 where com_no=#{com_no}
	</update>
	
	<!-- 상세정보 구하기 -->
	<select id="Content" parameterType="int" resultType="community">
	   select * from community where com_no = #{com_no}
	</select>
	
	<!-- 글수정 --> 
	
	<update id="update" parameterType="community">
		update community set com_writer=#{com_writer}, com_title=#{com_title}
		,com_content=#{com_content}, com_reg=sysdate where com_no=#{com_no}
	</update>
	
	  <!-- 글삭제     -->
	<delete id="delete" parameterType="int">
	delete from community where com_no = #{com_no}
	</delete>	 
	</mapper>
